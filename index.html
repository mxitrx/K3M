<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>K3M Finance Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css" />
</head>

<body class="min-h-screen flex flex-col">

  <!-- Header -->
  <header class="w-full p-4 flex justify-between items-center">
    <img src="k3m.PNG" alt="img" style="height: 50px; width: 50px; border-radius: 10%; text-align: left;">
    <h1 class="text-lg font-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏á‡∏¥‡∏ô | K3M Production</h1> <button id="toggleMode" class="border px-3 py-1 rounded">üåô ‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î</button>
  </header>

  <main class="container mx-auto py-6 space-y-8">

<!-- üí∞ ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ -->
    <section class="text-center">
      <h2 class="text-lg font-semibold mb-2">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h2>
      <p id="balanceText" class="balance">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </section>

    <!-- üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏° -->
    <section class="card">
      <h3 class="font-bold mb-3">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
              <th>‡∏ä‡∏∑‡πà‡∏≠</th>
              <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
              <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
              <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
            </tr>
          </thead>
          <tbody id="historyBody"></tbody>
        </table>
      </div>
    </section>

    <!-- üë• ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• -->
    <section class="card">
      <h3 class="font-bold mb-3">üë• ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h3>
      <div id="personSummary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2"></div>
    </section>

    <!-- ‚ûï ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô -->
    <section class="card">
      <h3 class="font-bold mb-3 text-yellow-600">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤</h3>
      <form id="incomeForm" class="form-grid">
        <select id="incomeName">
          <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô --</option>
          <option>‡∏Ñ‡∏∏‡∏ì‡∏≤‡∏ô‡∏ô‡∏ï‡πå ‡∏°‡∏ô‡∏ï‡∏£‡∏µ‡∏Å‡∏≤‡∏ô‡∏ô‡∏ó‡πå</option>
          <option>‡∏ô‡∏ô‡∏ó‡πå‡∏ß‡∏£‡∏¥‡∏® ‡∏†‡∏¥‡∏ç‡πÇ‡∏ç‡∏´‡∏¥‡∏£‡∏±‡∏ç‡∏£‡∏±‡∏ï‡∏ô‡πå</option>
          <option>‡∏ô‡∏û‡∏≠‡∏±‡∏õ‡∏™‡∏£ ‡∏≠‡πâ‡∏ô‡∏ó‡∏≠‡∏á</option>
          <option>‡∏ô‡∏±‡∏ô‡∏ò‡∏¥‡∏î‡∏≤ ‡∏ô‡πâ‡∏≠‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
          <option>‡∏û‡∏±‡∏ä‡∏£‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡∏ß‡∏¥‡πÇ‡∏£‡∏à‡∏ô‡πå‡∏ä‡∏µ‡∏ß‡∏±‡∏ô</option>
          <option>‡∏û‡∏¥‡∏ò‡∏≤‡∏ô‡∏ô‡∏ó‡πå ‡∏ô‡πà‡∏ß‡∏°‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏µ</option>
          <option>‡∏£‡∏±‡∏ä‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏ä‡∏•‡∏≠‡∏∏‡∏î‡∏°‡∏Å‡∏∏‡∏•</option>
          <option>‡∏ß‡∏£‡∏û‡∏• ‡∏ú‡∏•‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå</option>
          <option>‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥‡∏§‡∏ó‡∏ò‡∏¥‡πå ‡∏Å‡∏∏‡∏ô‡∏®‡∏¥‡∏£‡∏¥</option>
        </select>

        <input type="number" id="incomeAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)">
        <textarea id="incomeDesc" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..." class="form-full"></textarea>
        <input type="file" id="incomeImage" accept="image/*" class="form-full">
        <button type="submit" class="btn btn-yellow form-full">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤</button>
      </form>
    </section>

    <!-- ‚ûñ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏≠‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å -->
    <section class="card">
      <h3 class="font-bold mb-3 text-red-500">‡πÄ‡∏≠‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å</h3>
      <form id="expenseForm" class="form-grid">
        <select id="expenseName">
          <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô --</option>
          <option>‡∏Ñ‡∏∏‡∏ì‡∏≤‡∏ô‡∏ô‡∏ï‡πå ‡∏°‡∏ô‡∏ï‡∏£‡∏µ‡∏Å‡∏≤‡∏ô‡∏ô‡∏ó‡πå</option>
          <option>‡∏ô‡∏ô‡∏ó‡πå‡∏ß‡∏£‡∏¥‡∏® ‡∏†‡∏¥‡∏ç‡πÇ‡∏ç‡∏´‡∏¥‡∏£‡∏±‡∏ç‡∏£‡∏±‡∏ï‡∏ô‡πå</option>
          <option>‡∏ô‡∏û‡∏≠‡∏±‡∏õ‡∏™‡∏£ ‡∏≠‡πâ‡∏ô‡∏ó‡∏≠‡∏á</option>
          <option>‡∏ô‡∏±‡∏ô‡∏ò‡∏¥‡∏î‡∏≤ ‡∏ô‡πâ‡∏≠‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
          <option>‡∏û‡∏±‡∏ä‡∏£‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡∏ß‡∏¥‡πÇ‡∏£‡∏à‡∏ô‡πå‡∏ä‡∏µ‡∏ß‡∏±‡∏ô</option>
          <option>‡∏û‡∏¥‡∏ò‡∏≤‡∏ô‡∏ô‡∏ó‡πå ‡∏ô‡πà‡∏ß‡∏°‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏µ</option>
          <option>‡∏£‡∏±‡∏ä‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏ä‡∏•‡∏≠‡∏∏‡∏î‡∏°‡∏Å‡∏∏‡∏•</option>
          <option>‡∏ß‡∏£‡∏û‡∏• ‡∏ú‡∏•‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå</option>
          <option>‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥‡∏§‡∏ó‡∏ò‡∏¥‡πå ‡∏Å‡∏∏‡∏ô‡∏®‡∏¥‡∏£‡∏¥</option>
        </select>

        <input type="number" id="expenseAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)">
        <textarea id="expenseDesc" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..." class="form-full"></textarea>
        <input type="file" id="expenseImage" accept="image/*" class="form-full">
        <button type="submit" class="btn btn-red form-full">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å</button>
      </form>
    </section>

  </main>

  <footer class="text-center py-4 text-gray-500 dark:text-gray-400 border-t">
    ¬© 2025 K3M Production
  </footer>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwqbNPHG6xLiLJQ8Zgvm60s7PQcSahobKl4YpXWIN1ceOcZd5j-lbKhKJ6tbY2Y49FEdw/exec";

    // üåó Toggle Dark/Light
    const toggleBtn = document.getElementById("toggleMode");
    toggleBtn.addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
      toggleBtn.textContent = document.documentElement.classList.contains("dark")
        ? "‚òÄÔ∏è ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ß‡πà‡∏≤‡∏á"
        : "üåô ‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î";
    });

    // üìÖ ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤
    function formatDate(dateStr) {
      const d = new Date(dateStr);
      const day = String(d.getDate()).padStart(2, '0');
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const year = String(d.getFullYear()).slice(-2);
      const hours = String(d.getHours()).padStart(2, '0');
      const mins = String(d.getMinutes()).padStart(2, '0');
      return `${day}/${month}/${year} ${hours}:${mins}`;
    }

    async function loadSummary() {
      const res = await fetch(SCRIPT_URL + "?action=getSummary");
      const data = await res.json();
      const balance = (data.income || 0) - (data.expense || 0);
      const balanceEl = document.getElementById("balanceText");
      balanceEl.textContent = balance.toLocaleString() + " ‡∏ö‡∏≤‡∏ó";
      balanceEl.className = "balance " + (balance >= 0 ? "positive" : "negative");

      const summaryDiv = document.getElementById("personSummary");
      summaryDiv.innerHTML = "";
      Object.entries(data.persons || {}).forEach(([name, total]) => {
        const color = total >= 0 ? "text-green-600" : "text-red-500";
        summaryDiv.innerHTML += `<div class="border p-2 rounded text-sm flex justify-between dark:border-gray-700">
          <span>${name}</span><span class="${color}">${total.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
        </div>`;
      });
    }

    async function loadHistory() {
      const res = await fetch(SCRIPT_URL + "?action=getHistory");
      const data = await res.json();
      const body = document.getElementById("historyBody");
      body.innerHTML = "";
      data.slice(0, 10).forEach(row => {
        const color = row.type === "‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤" ? "text-green-600" : "text-red-500";
        body.innerHTML += `
          <tr>
            <td>${formatDate(row.date)}</td>
            <td>${row.name}</td>
            <td class="${color}">${row.type}</td>
            <td>${Number(row.amount).toLocaleString()}</td>
            <td>${row.desc}</td>
          </tr>`;
      });
    }

    async function submitForm(formId, actionType) {
      const name = document.getElementById(formId + "Name").value;
      const amount = document.getElementById(formId + "Amount").value;
      const desc = document.getElementById(formId + "Desc").value;
      const file = document.getElementById(formId + "Image").files[0];
      if (!name || !amount) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

      const formData = new FormData();
      formData.append("action", actionType);
      formData.append("personName", name);
      formData.append("amount", amount);
      formData.append("description", desc);
      if (file) formData.append("image", file);

      const res = await fetch(SCRIPT_URL, { method: "POST", body: formData });
      const result = await res.json();
      if (result.result === "success") {
        alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
        loadSummary();
        loadHistory();
      } else alert("‚ùå " + result.message);
    }

    document.getElementById("incomeForm").onsubmit = e => { e.preventDefault(); submitForm("income", "addIncome"); };
    document.getElementById("expenseForm").onsubmit = e => { e.preventDefault(); submitForm("expense", "addExpense"); };

    loadSummary();
    loadHistory();
  </script>
</body>
</html>
